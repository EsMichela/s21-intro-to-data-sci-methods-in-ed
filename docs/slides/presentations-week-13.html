<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Week 13 - Basic advanced techniques</title>
    <meta charset="utf-8" />
    <meta name="author" content="Joshua Rosenberg and Alex Lishinski" />
    <meta name="date" content="2021-04-15" />
    <script src="libs/header-attrs-2.6/header-attrs.js"></script>
    <link rel="stylesheet" href="theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Week 13 - Basic advanced techniques
### Joshua Rosenberg and Alex Lishinski
### April 15, 2021

---




# Welcome!

Welcome to *week 13*!



**Record the meeting** 



---

# Breakout rooms!

Starting with whomever has the most pets:

- What is something about R you've learned working on your final project that goes beyond what we've covered in class?

Prepare one-three responses to each of the above questions to share with the whole class!


---

## A recap of last week (on functional programming)

- R has built in functions from packages, but you can write your own too!

- The purrr package offers tools to do multiple iterations of operations

---

## Checking-in on final projects

Responses to feedback - we will be checking tomorrow!

Reminder - final project and recording due by May 5

---

## Homework highlights


&lt;img src="img/w13-f2.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Homework highlights

&lt;img src="img/w13-f1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Homework highlights

&lt;img src="img/w13-f3.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Chunk options

*For a single chunk*:

- eval = FALSE
- echo = FALSE
- warning = FALSE
- message = FALSE

*For the entire document*:

- knitr::opts_chunk$set(echo = FALSE, echo = FALSE, warning = FALSE, message = FALSE)

---

### Topics for today

**Record the meeting** 

A. Continued discussion on purrr - Iteration (or, _applying_ functions)

B. Introduction to missing data procedures with MICE 

(C. On creating maps using ggplot2)  

---

### A. Iteration

Iteration is another name for your computer carrying out some step(s) multiple times.

Iteration is helpful when, even after writing a function, you find yourself copying and pasting the same code (with modifications)

---

### A. Iteration

Iteration can be helpful when you want to apply a function multiple times.

The map functions can help with this. There are different ones based on the type of object returned.

The key to understanding (and writing) functions is understanding what kind of input they take and what kind of output they return.

`map()` - Applies function to every element of a list and return a list
`map2()` - Applies function to every element from 2 lists and return a list

Lists are ordered collections of any other type of object. You can have a list of vectors, a list of data frames, and a list of different types of objects. 

`map_chr()` - returns a char vector of objects created
`map_dbl()` - returns a numeric vector of objects created
`map_dfc()` - objects created become columns of data frame
`map_dfr()` - objects created become rows of a data frame


---

### A. Iteration

Example: COVID vaccine data

&lt;blockquote class="twitter-tweet"&gt;&lt;b&gt;&lt;p lang="de" dir="ltr"&gt;Pfizer, Johnson &amp;amp; Johnson, Moderna &lt;a href="https://t.co/P1fTcCEoTP"&gt;pic.twitter.com/P1fTcCEoTP&lt;/a&gt;&lt;/p&gt;&lt;/b&gt;
![](img/vax.jpeg)
&amp;mdash; NFL Memes (@NFL_Memes) &lt;a href="https://twitter.com/NFL_Memes/status/1381317131690725378?ref_src=twsrc%5Etfw"&gt;April 11, 2021&lt;/a&gt;&lt;/blockquote&gt; &lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt; 


---

### A. Iteration

Example: COVID vaccine data - Read in the data

One way to load data:


```r
pfi &lt;- read_csv(here("data", "COVID", "COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_Pfizer.csv"))
mod &lt;- read_csv(here("data", "COVID", "COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_Moderna.csv"))
jan &lt;- read_csv(here("data", "COVID", "COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_Janssen.csv"))
jan
```

```
## # A tibble: 378 x 3
##    Jurisdiction  `Week of Allocations` `1st Dose Allocations`
##    &lt;chr&gt;         &lt;chr&gt;                                  &lt;dbl&gt;
##  1 Connecticut   04/12/2021                              6400
##  2 Maine         04/12/2021                              2500
##  3 Massachusetts 04/12/2021                             12300
##  4 New Hampshire 04/12/2021                              2500
##  5 Rhode Island  04/12/2021                              2000
##  6 Vermont       04/12/2021                              1200
##  7 New Jersey    04/12/2021                             15600
##  8 New York      04/12/2021                             19800
##  9 New York City 04/12/2021                             15100
## 10 Puerto Rico   04/12/2021                              6100
## # … with 368 more rows
```

---

### A. Iteration

Example: COVID vaccine data - Read in the data


```r
vaccines &lt;- c("Pfizer", "Moderna", "Janssen")
file_base &lt;- "/COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_"
file_ext &lt;- ".csv"

file_names &lt;- str_c(here("data", "COVID"), file_base, vaccines, file_ext)

vax_files &lt;- file_names %&gt;% map(read_csv)
names(vax_files) &lt;- vaccines
vax_files
```

```
## $Pfizer
## # A tibble: 1,134 x 4
##    Jurisdiction  `Week of Allocations` `1st Dose Allocations` `2nd Dose Allocations`
##    &lt;chr&gt;         &lt;chr&gt;                                  &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Connecticut   04/12/2021                             51480                  51480
##  2 Maine         04/12/2021                             19890                  19890
##  3 Massachusetts 04/12/2021                             97110                  97110
##  4 New Hampshire 04/12/2021                             19890                  19890
##  5 Rhode Island  04/12/2021                             15210                  15210
##  6 Vermont       04/12/2021                              9360                   9360
##  7 New Jersey    04/12/2021                            124020                 124020
##  8 New York      04/12/2021                            156780                 156780
##  9 New York City 04/12/2021                            119340                 119340
## 10 Puerto Rico   04/12/2021                             49140                  49140
## # … with 1,124 more rows
## 
## $Moderna
## # A tibble: 1,071 x 4
##    Jurisdiction  `Week of Allocations` `1st Dose Allocations` `2nd Dose Allocations`
##    &lt;chr&gt;         &lt;chr&gt;                                  &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Connecticut   04/12/2021                             37400                  37400
##  2 Maine         04/12/2021                             14300                  14300
##  3 Massachusetts 04/12/2021                             72100                  72100
##  4 New Hampshire 04/12/2021                             14300                  14300
##  5 Rhode Island  04/12/2021                             11300                  11300
##  6 Vermont       04/12/2021                              6700                   6700
##  7 New Jersey    04/12/2021                             91300                  91300
##  8 New York      04/12/2021                            116300                 116300
##  9 New York City 04/12/2021                             88300                  88300
## 10 Puerto Rico   04/12/2021                             35700                  35700
## # … with 1,061 more rows
## 
## $Janssen
## # A tibble: 378 x 3
##    Jurisdiction  `Week of Allocations` `1st Dose Allocations`
##    &lt;chr&gt;         &lt;chr&gt;                                  &lt;dbl&gt;
##  1 Connecticut   04/12/2021                              6400
##  2 Maine         04/12/2021                              2500
##  3 Massachusetts 04/12/2021                             12300
##  4 New Hampshire 04/12/2021                              2500
##  5 Rhode Island  04/12/2021                              2000
##  6 Vermont       04/12/2021                              1200
##  7 New Jersey    04/12/2021                             15600
##  8 New York      04/12/2021                             19800
##  9 New York City 04/12/2021                             15100
## 10 Puerto Rico   04/12/2021                              6100
## # … with 368 more rows
```


---

### A. Iteration

Example: COVID vaccine data - Rename the data


```r
# write my rename function
rename_vaccine_data &lt;- function(dat){
  dat &lt;- dat %&gt;% rename("State" = "Jurisdiction",
                 "Week" = "Week of Allocations",
                 "First Dose" = "1st Dose Allocations",
                 "Second Dose" = "2nd Dose Allocations")
  dat
}

# map it to every data set in the list
vax_files %&gt;% map(rename_vaccine_data)
```

Error: Can't rename columns that don't exist. x Column `2nd Dose Allocations` doesn't exist.

---

### A. Iteration

Example: COVID vaccine data - Rename the data


```r
rename_vaccine_data &lt;- function(dat){
  if(ncol(dat) == 4){
    dat &lt;- dat %&gt;% rename("State" = "Jurisdiction",
                          "Week" = "Week of Allocations",
                          "First Dose" = "1st Dose Allocations",
                          "Second Dose" = "2nd Dose Allocations")
    dat
  } else {
    dat &lt;- dat %&gt;% rename("State" = "Jurisdiction",
                          "Week" = "Week of Allocations",
                          "First Dose" = "1st Dose Allocations")
    dat
  }

}

vax_files &lt;- vax_files %&gt;% map(rename_vaccine_data)
vax_files$Pfizer
```

```
## # A tibble: 1,134 x 4
##    State         Week       `First Dose` `Second Dose`
##    &lt;chr&gt;         &lt;chr&gt;             &lt;dbl&gt;         &lt;dbl&gt;
##  1 Connecticut   04/12/2021        51480         51480
##  2 Maine         04/12/2021        19890         19890
##  3 Massachusetts 04/12/2021        97110         97110
##  4 New Hampshire 04/12/2021        19890         19890
##  5 Rhode Island  04/12/2021        15210         15210
##  6 Vermont       04/12/2021         9360          9360
##  7 New Jersey    04/12/2021       124020        124020
##  8 New York      04/12/2021       156780        156780
##  9 New York City 04/12/2021       119340        119340
## 10 Puerto Rico   04/12/2021        49140         49140
## # … with 1,124 more rows
```

---

### B. Multiple Imputation of missing data with MICE

`lm()` default way of dealing with missing data: listwise deletion

Better way to deal with missing data: imputation

Basic idea:

If data missing, you can fill in values that let you estimate your model on whole data

Good: Mean imputation

Better: Model based imputation

Best: Multiple imputation

---

### B. Multiple Imputation of missing data with MICE

The MICE package: Multiple Imputation using Chained Equations

Dealing with missing data is a big idea, and the nuances can be tricky

Our goal is to show you that you need not be intimidated by approaching this task in R

If you are doing inferential models in your analyses, MI is a tool that should be in your toolkit

---

### B. Multiple Imputation of missing data with MICE

Example: Regression model


```r
ug_data &lt;- read_csv(here("data", "undergrad_data.csv"))

vis_dat(ug_data)
```

&lt;img src="presentations-week-13_files/figure-html/unnamed-chunk-11-1.png" style="display: block; margin: auto;" /&gt;

```r
na.omit(ug_data)
```

```
## # A tibble: 419 x 29
##       X1 Stud_ID   PROJ_TOTAL Proj01 Proj02 Proj03 Proj04 Proj05 Proj06 Proj07 Proj08 Proj09 Proj10 Proj11 Total_Pts Exam1 Exam2
##    &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1 e75ab8254        347     14     19     13     25     27     35     40     47     44     35     48       622    60    60
##  2     2 07ee7a263        427     14     20     20     38     45     42     41     50     52     53     52       902    80   125
##  3     4 52fb2d1ca        397     14     18     19      0     43     43     50     50     52     53     55       831    80   120
##  4     5 a4d76f570        316     14     20     12     36      8     34      0     41     52     49     50       757    76   120
##  5     6 94ea75daa        435     14     20     19     36     45     45     50     50     55     46     55       929    84   135
##  6     7 5e9c38d44        375     13     20     20     36     43     38     46     40     50     22     47       822    76   135
##  7    10 21d036526        354     13     18     17     32     40     33     16     39     52     40     54       810    76   105
##  8    11 3fc8237b5        295     13     20     20     34     43     41     50     19     55      0      0       640    76    90
##  9    14 7e2674224        441     14     20     20     38     44     45     50     48     55     53     54       959    88   145
## 10    15 bc0032340        385     14     20     10     27     38     34     50     42     51     45     54       840    80   140
## # … with 409 more rows, and 12 more variables: Exam3 &lt;dbl&gt;, Prob_solve_pre &lt;dbl&gt;, Prob_solve_post &lt;dbl&gt;, extraversion &lt;dbl&gt;,
## #   agreeableness &lt;dbl&gt;, conscient. &lt;dbl&gt;, stability &lt;dbl&gt;, openness &lt;dbl&gt;, Metacog. &lt;dbl&gt;, SelfEfficacy &lt;dbl&gt;,
## #   IntGoalOrient &lt;dbl&gt;, ExtGoalOrient &lt;dbl&gt;
```

---

### B. Multiple Imputation of missing data with MICE

Example: Regression model


```r
fit &lt;- lm(PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + conscient. + stability + openness  + Metacog. + SelfEfficacy + IntGoalOrient + ExtGoalOrient, 
          data = ug_data)
```

---

### B. Multiple Imputation of missing data with MICE

Example: Regression model


```r
summary(fit)
```

```
## 
## Call:
## lm(formula = PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + 
##     conscient. + stability + openness + Metacog. + SelfEfficacy + 
##     IntGoalOrient + ExtGoalOrient, data = ug_data)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -334.72  -16.93   23.01   44.39   97.40 
## 
## Coefficients:
##                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)    307.7820    35.8305   8.590  &lt; 2e-16 ***
## Prob_solve_pre   3.3656     0.7639   4.406 1.34e-05 ***
## extraversion    -0.2442     0.3854  -0.634    0.527    
## agreeableness   -0.1068     0.4867  -0.219    0.826    
## conscient.       0.9207     0.4823   1.909    0.057 .  
## stability        0.2047     0.3803   0.538    0.591    
## openness         0.3604     0.5615   0.642    0.521    
## Metacog.        -0.1107     0.5011  -0.221    0.825    
## SelfEfficacy    -0.2373     0.5916  -0.401    0.689    
## IntGoalOrient    0.1982     1.0673   0.186    0.853    
## ExtGoalOrient    0.1893     0.8883   0.213    0.831    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 73.46 on 416 degrees of freedom
##   (187 observations deleted due to missingness)
## Multiple R-squared:  0.07321,	Adjusted R-squared:  0.05093 
## F-statistic: 3.286 on 10 and 416 DF,  p-value: 0.0004114
```

---

### B. Multiple Imputation of missing data with MICE

The MICE package: viewing missing data pattern


```r
library(mice)

md.pattern(ug_data)
```

&lt;img src="presentations-week-13_files/figure-html/unnamed-chunk-14-1.png" style="display: block; margin: auto;" /&gt;

```
##     X1 Stud_ID PROJ_TOTAL Proj01 Proj02 Proj03 Proj04 Proj05 Proj06 Proj07 Proj08 Proj09 Proj10 Proj11 Total_Pts Exam1 Exam2 Exam3
## 419  1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 18   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 10   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 2    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 12   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 7    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 2    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 19   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 23   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 8    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 2    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 40   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 4    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 5    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 24   1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 4    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 1    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
## 5    1       1          1      1      1      1      1      1      1      1      1      1      1      1         1     1     1     1
##      0       0          0      0      0      0      0      0      0      0      0      0      0      0         0     0     0     0
##     Prob_solve_pre Prob_solve_post Metacog. SelfEfficacy IntGoalOrient ExtGoalOrient extraversion openness conscient.
## 419              1               1        1            1             1             1            1        1          1
## 18               1               1        1            1             1             1            1        1          1
## 10               1               1        1            1             1             1            1        1          1
## 2                1               1        1            1             1             1            1        1          1
## 12               1               1        1            1             1             1            1        1          0
## 7                1               1        1            1             1             1            1        0          1
## 2                1               1        1            1             1             1            1        0          1
## 19               1               1        1            1             1             1            0        0          0
## 23               1               1        0            0             0             0            1        1          1
## 1                1               1        0            0             0             0            1        1          1
## 1                1               1        0            0             0             0            1        1          0
## 1                1               1        0            0             0             0            0        0          0
## 8                1               0        1            1             1             1            1        1          1
## 2                1               0        1            1             1             1            1        1          1
## 1                1               0        1            1             1             1            1        0          1
## 40               1               0        1            1             1             1            0        0          0
## 1                1               0        0            0             0             0            1        1          1
## 4                1               0        0            0             0             0            0        0          0
## 5                0               1        1            1             1             1            1        1          1
## 1                0               1        1            1             1             1            0        0          0
## 24               0               1        0            0             0             0            1        1          1
## 1                0               1        0            0             0             0            1        1          1
## 1                0               1        0            0             0             0            1        0          0
## 4                0               1        0            0             0             0            0        0          0
## 1                0               0        1            1             1             1            1        1          1
## 1                0               0        0            0             0             0            1        1          1
## 5                0               0        0            0             0             0            0        0          0
##                 43              63       67           67            67            67           74       85         88
##     agreeableness stability    
## 419             1         1   0
## 18              1         0   1
## 10              0         1   1
## 2               0         0   2
## 12              1         0   2
## 7               1         1   1
## 2               0         1   2
## 19              0         0   5
## 23              1         1   4
## 1               1         0   5
## 1               1         0   6
## 1               0         0   9
## 8               1         1   1
## 2               0         1   2
## 1               1         1   2
## 40              0         0   6
## 1               1         1   5
## 4               0         0  10
## 5               1         1   1
## 1               0         0   6
## 24              1         1   5
## 1               1         0   6
## 1               1         0   8
## 4               0         0  10
## 1               1         1   2
## 1               1         1   6
## 5               0         0  11
##                90       110 821
```

---

### B. Multiple Imputation of missing data with MICE

The MICE package: Generating imputed data sets with `mice()`


```r
ug_data_imp &lt;- mice(ug_data, m = 5)
```

```
## 
##  iter imp variable
##   1   1  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   1   2  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   1   3  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   1   4  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   1   5  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   2   1  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   2   2  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   2   3  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   2   4  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   2   5  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   3   1  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   3   2  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   3   3  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   3   4  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   3   5  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   4   1  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   4   2  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   4   3  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   4   4  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   4   5  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   5   1  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   5   2  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   5   3  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   5   4  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
##   5   5  Prob_solve_pre  Prob_solve_post  extraversion  agreeableness  conscient.  stability  openness  Metacog.  SelfEfficacy  IntGoalOrient  ExtGoalOrient
```

```
## Warning: Number of logged events: 276
```

---

### B. Multiple Imputation of missing data with MICE

The MICE package: Examining missing data


```r
ug_data_imp$imp$SelfEfficacy
```

```
##      1  2  3  4  5
## 3   39 48 55 47 42
## 18  32 46 41 52 20
## 35  54 56 41 55 38
## 42  56 43 42 53 41
## 90  45 47 28 35 49
## 94  34 48 45 42 40
## 100 21 44 52 29 44
## 111 53 44 35 35 41
## 124 25 31 32 44 35
## 134 42 29 45 40 22
## 137 47 53 28 55 52
## 148 44 49 28 34 50
## 166 32 34 36 27 44
## 171 47 56 46 36 45
## 176 30 54 46 46 35
## 190 31 56 42 26 26
## 193 47 55 28 48 32
## 208 47 47 27 32 41
## 225 45 32 56 32 46
## 226 48 31 25 56 17
## 236 33 49 48 54 35
## 237 28 50 48 56 36
## 238 32 44 41 49 44
## 242 46 32 29 28 41
## 246 56 32 26 45 47
## 250 56 51 43 46 39
## 257 54 54 48 41 49
## 259 16 43 30 28 43
## 260 45 44 38 32 56
## 267 46 32 48 46 42
## 283 36 32 45 26 37
## 287 49 47 55 33 48
## 299 40 48 34 35 44
## 301 48 21 33 38 30
## 311 43 35 35 47 30
## 315 40 40 16 24 46
## 340 30 32 31 34 33
## 342 48 56 30 45 42
## 351 45 37 16 31 35
## 373 49 51 51 23 49
## 377 47 46 48 49 45
## 379 53 56 53 41 54
## 392 45 49 43 53 51
## 400 51 51 47 49 45
## 403 47 55 48 53 46
## 408 31 48 28 55 35
## 450 48 36 28 34 41
## 452 42 43 34 49 30
## 456 40 43 51 56 52
## 460 48 32 32 34 42
## 464 55 44 46 48 34
## 490 44 28 33 39 54
## 503 46 37 23 56 45
## 506 47 35 45 33 34
## 517 42 30 29 54 44
## 520 48 50 32 33 37
## 533 46 48 56 39 33
## 535 56 53 21 46 56
## 538 32 31 42 48 48
## 547 42 56 49 38 40
## 553 53 51 39 41 32
## 557 38 48 42 32 40
## 565 43 36 46 32 41
## 568 46 42 38 53 48
## 581 53 33 47 45 23
## 589 30 46 42 41 42
## 606 29 48 41 41 37
```


---

### B. Multiple Imputation of missing data with MICE

The MICE package: Extracting data sets with `complete()`


```r
comp_data &lt;- complete(ug_data_imp, 2)
comp_data
```

```
##    X1   Stud_ID PROJ_TOTAL Proj01 Proj02 Proj03 Proj04 Proj05 Proj06 Proj07 Proj08 Proj09 Proj10 Proj11 Total_Pts Exam1 Exam2
## 1   1 e75ab8254        347     14     19     13     25     27     35     40     47     44     35     48       622    60    60
## 2   2 07ee7a263        427     14     20     20     38     45     42     41     50     52     53     52       902    80   125
## 3   3 9c02eb000        393     14     18     16     37     42     44     45     41     50     37     49       829    96   115
## 4   4 52fb2d1ca        397     14     18     19      0     43     43     50     50     52     53     55       831    80   120
## 5   5 a4d76f570        316     14     20     12     36      8     34      0     41     52     49     50       757    76   120
## 6   6 94ea75daa        435     14     20     19     36     45     45     50     50     55     46     55       929    84   135
## 7   7 5e9c38d44        375     13     20     20     36     43     38     46     40     50     22     47       822    76   135
## 8   8 e5a5608e8        398     14     17     19     39     45     41     49     20     55     47     52       783    64   110
## 9   9 f2abdba22        350     14     18     18     37     44      0     45     43     51     40     40       696    52    90
## 10 10 21d036526        354     13     18     17     32     40     33     16     39     52     40     54       810    76   105
## 11 11 3fc8237b5        295     13     20     20     34     43     41     50     19     55      0      0       640    76    90
## 12 12 72ccca5a0        440     14     20     20     40     45     45     50     48     55     48     55       877    80   115
## 13 13 ca5073861         52     14     12      0     26      0      0      0      0      0      0      0        52     0     0
## 14 14 7e2674224        441     14     20     20     38     44     45     50     48     55     53     54       959    88   145
## 15 15 bc0032340        385     14     20     10     27     38     34     50     42     51     45     54       840    80   140
## 16 16 56bb07c2e        370     10     18     18     37     29     43     40     34     49     40     52       753    68    80
## 17 17 74afe8807        332     14     18     18     35     43      0     43     39     35     47     40       642    60    80
## 18 18 70653b198        279     14     20     18     32     43      0      0     43     51     42     16       641    68    90
## 19 19 c19bd5d09        406     14     20     16     37     41     45     50     38     47     45     53       876    84   135
## 20 20 758e0f2e4        340     15     20     20     40     32     43     44     21     50      0     55       744    84   120
## 21 21 2e3be0621        372     14     13     15     28     44     43     50      0     55     55     55       760    68   110
## 22 22 f7fc7c540        410     15     20     20     39     44     45     50     45     27     50     55       816    80   115
## 23 23 8a78da3d7        448     15     20     20     40     45     45     50     50     53     55     55       945    88   150
## 24 24 d032ddcba        408     15     20     10     25     45     45     50     49     48     48     53       814    60   110
## 25 25 f5fbfaa43        437     15     20     20     40     45     40     48     46     53     55     55       886    84    95
## 26 26 897c10248        348     15     18     14      0     37     42     44     44     55     28     51       646    72   110
## 27 27 006a7e31c        119     15     19     10     40      4     31      0      0      0      0      0       351    68    65
## 28 28 d7ebdcc64        299     13     20     20     40     39     45     14      4     34     30     40       678    68   110
## 29 29 2f9655115        392     13     20     17     33     39     45     49     45     52     34     45       736    64    95
## 30 30 1158a4bb2        446     15     20     20     38     43     45     50     50     55     55     55       872    72   120
## 31 31 da8783e45        438     15     20      9     40     45     45     50     50     55     54     55       805    72   110
## 32 32 34d07adfb        172      0     12     14     28     42     25      0     22      0      5     24       512    60    80
## 33 33 df6e080db        102     14      5      8     25     45      5      0      0      0      0      0       272    60   110
## 34 34 b467b6487         83     15     18      0      0      0      0     50      0      0      0      0       216    48    85
##    Exam3 Prob_solve_pre Prob_solve_post extraversion agreeableness conscient. stability openness Metacog. SelfEfficacy
## 1     55       3.500000        4.666667           52            51         47        43       42       65           50
## 2    170      16.000000       15.000000           29            50         54        58       38       31           32
## 3    125       7.000000        5.000000           55            59         46        53       48       49           48
## 4    135      10.000000       14.500000           25            29         38        37       53       34           48
## 5    145       2.333333       13.000000           50            50         60        59       43       54           48
## 6    175       8.000000       15.000000           37            54         50        56       47       47           49
## 7    136       3.833333        8.000000           38            50         63        43       44       53           45
## 8    111       5.333333       19.000000           49            48         62        32       57       65           56
## 9    105       4.666667        4.333333           58            65         50        46       48       55           21
## 10   175      10.000000        5.333333           47            42         42        34       42       48           42
## 11    80       0.000000        2.000000           45            69         56        38       66       67           56
## 12   150       3.333333        7.000000           32            56         50        47       49       55           45
## 13     0       3.500000       13.500000           39            36         40        46       54       60           40
## 14   185      16.000000       20.000000           42            59         68        24       57       57           46
## 15   135       3.333333        5.333333           47            37         45        51       41       43           44
## 16   135       1.000000        0.000000           40            39         40        43       40       46           38
## 17    70       4.166667        9.000000           42            53         58        59       50       53           43
## 18   105       1.000000        0.000000           41            43         40        43       38       47           46
## 19   151      18.000000       19.500000           47            62         55        47       53       43           48
## 20   110      17.500000       18.000000           24            47         41        31       48       42           43
## 21   110       8.333333       11.500000           34            44         48        36       36       58           26
## 22   111       7.000000       13.000000           47            41         48        38       40       42           43
## 23   160      11.666667       15.833333           60            60         53        48       68       58           48
## 24   136       2.000000        0.000000           41            37         38        51       31       40           32
## 25   170      16.000000       21.000000           50            44         38        62       51       39           48
## 26   116      10.000000        5.333333           26            45         48        40       38       40           32
## 27    95      14.500000        2.000000           35            39         34        35       38       53           18
## 28   106      18.833333        7.000000           51            56         40        55       63       42           47
## 29    90      12.833333       15.333333           36            54         63        54       52       40           32
## 30   135      13.000000       19.500000           56            39         50        61       48       40           48
## 31    85      11.500000        9.166667           51            45         51        50       45       47           28
## 32   100       3.333333        3.000000           57            41         40        54       40       44           28
## 33     0       3.666667       15.000000           34            52         46        48       51       32           25
## 34     0       4.666667       17.500000           24            40         54        49       44       42           30
##    IntGoalOrient ExtGoalOrient
## 1             25            26
## 2             13            16
## 3             22            28
## 4             14            26
## 5             19            22
## 6             23            22
## 7             23            18
## 8             25            25
## 9              9            18
## 10            22            28
## 11            28            22
## 12            26            28
## 13            22            25
## 14            17            24
## 15            19            23
## 16            20            16
## 17            20            14
## 18            24            22
## 19            25            24
## 20            20            26
## 21            22            24
## 22            20            24
## 23            21            27
## 24             4            19
## 25            20            19
## 26            16            16
## 27             9            28
## 28            19            21
## 29            19            16
## 30            16            23
## 31            11            23
## 32            22            28
## 33            14            12
## 34            16            16
##  [ reached 'max' / getOption("max.print") -- omitted 580 rows ]
```


---

### B. Multiple Imputation of missing data with MICE

The MICE package: fitting models with `with()`


```r
fit_imp &lt;- with(data = ug_data_imp, exp = lm( PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + conscient. + stability + openness  + Metacog. + SelfEfficacy + IntGoalOrient + ExtGoalOrient))
fit_imp
```

```
## call :
## with.mids(data = ug_data_imp, expr = lm(PROJ_TOTAL ~ Prob_solve_pre + 
##     extraversion + agreeableness + conscient. + stability + openness + 
##     Metacog. + SelfEfficacy + IntGoalOrient + ExtGoalOrient))
## 
## call1 :
## mice(data = ug_data, m = 5)
## 
## nmis :
##              X1         Stud_ID      PROJ_TOTAL          Proj01          Proj02          Proj03          Proj04          Proj05 
##               0               0               0               0               0               0               0               0 
##          Proj06          Proj07          Proj08          Proj09          Proj10          Proj11       Total_Pts           Exam1 
##               0               0               0               0               0               0               0               0 
##           Exam2           Exam3  Prob_solve_pre Prob_solve_post    extraversion   agreeableness      conscient.       stability 
##               0               0              43              63              74              90              88             110 
##        openness        Metacog.    SelfEfficacy   IntGoalOrient   ExtGoalOrient 
##              85              67              67              67              67 
## 
## analyses :
## [[1]]
## 
## Call:
## lm(formula = PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + 
##     conscient. + stability + openness + Metacog. + SelfEfficacy + 
##     IntGoalOrient + ExtGoalOrient)
## 
## Coefficients:
##    (Intercept)  Prob_solve_pre    extraversion   agreeableness      conscient.       stability        openness        Metacog.  
##       260.9356          3.7502         -0.2821          0.8928          1.3440          0.2687         -0.5733         -1.9475  
##   SelfEfficacy   IntGoalOrient   ExtGoalOrient  
##         1.9685         -0.2016          0.3695  
## 
## 
## [[2]]
## 
## Call:
## lm(formula = PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + 
##     conscient. + stability + openness + Metacog. + SelfEfficacy + 
##     IntGoalOrient + ExtGoalOrient)
## 
## Coefficients:
##    (Intercept)  Prob_solve_pre    extraversion   agreeableness      conscient.       stability        openness        Metacog.  
##       228.5649          4.1882          0.1521          0.8290          1.6367         -0.4123         -0.2888         -1.5195  
##   SelfEfficacy   IntGoalOrient   ExtGoalOrient  
##         1.8675          0.4359         -0.2182  
## 
## 
## [[3]]
## 
## Call:
## lm(formula = PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + 
##     conscient. + stability + openness + Metacog. + SelfEfficacy + 
##     IntGoalOrient + ExtGoalOrient)
## 
## Coefficients:
##    (Intercept)  Prob_solve_pre    extraversion   agreeableness      conscient.       stability        openness        Metacog.  
##      263.70065         4.23989         0.02506         0.57056         1.46556        -0.04371        -0.86074        -1.56845  
##   SelfEfficacy   IntGoalOrient   ExtGoalOrient  
##        2.51464         0.54834        -1.34614  
## 
## 
## [[4]]
## 
## Call:
## lm(formula = PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + 
##     conscient. + stability + openness + Metacog. + SelfEfficacy + 
##     IntGoalOrient + ExtGoalOrient)
## 
## Coefficients:
##    (Intercept)  Prob_solve_pre    extraversion   agreeableness      conscient.       stability        openness        Metacog.  
##       225.0200          3.7799         -0.3698          0.2364          2.1427          0.5805         -0.2303         -1.1542  
##   SelfEfficacy   IntGoalOrient   ExtGoalOrient  
##         1.5713          0.2319         -0.7401  
## 
## 
## [[5]]
## 
## Call:
## lm(formula = PROJ_TOTAL ~ Prob_solve_pre + extraversion + agreeableness + 
##     conscient. + stability + openness + Metacog. + SelfEfficacy + 
##     IntGoalOrient + ExtGoalOrient)
## 
## Coefficients:
##    (Intercept)  Prob_solve_pre    extraversion   agreeableness      conscient.       stability        openness        Metacog.  
##       276.0025          3.6848         -0.3269          0.8603          1.9174         -0.5838         -0.4806         -1.8178  
##   SelfEfficacy   IntGoalOrient   ExtGoalOrient  
##         1.7985          0.7149         -0.5860
```

---

### B. Multiple Imputation of missing data with MICE

The MICE package: pooling output with `pool()`


```r
summary(pool(fit_imp))
```

```
##              term     estimate  std.error   statistic         df      p.value
## 1     (Intercept) 250.84471931 45.9701657  5.45668513  42.012481 2.388848e-06
## 2  Prob_solve_pre   3.92857609  0.8719647  4.50543022 205.323239 1.111012e-05
## 3    extraversion  -0.16033222  0.4882295 -0.32839517  47.195380 7.440655e-01
## 4   agreeableness   0.67783109  0.5899823  1.14890071  50.074676 2.560554e-01
## 5      conscient.   1.70127425  0.6163776  2.76011714  32.046286 9.476173e-03
## 6       stability  -0.03809738  0.6658560 -0.05721563   9.987118 9.555020e-01
## 7        openness  -0.48674313  0.6554846 -0.74256989 102.224310 4.594451e-01
## 8        Metacog.  -1.60148596  0.6129725 -2.61265563  40.454957 1.255195e-02
## 9    SelfEfficacy   1.94410779  0.7041804  2.76080940  40.767563 8.602390e-03
## 10  IntGoalOrient   0.34587931  1.1626651  0.29748833 203.062703 7.663978e-01
## 11  ExtGoalOrient  -0.50417035  1.1836683 -0.42593888  30.774582 6.731167e-01
```

```r
broom::tidy(fit)
```

```
## # A tibble: 11 x 5
##    term           estimate std.error statistic  p.value
##    &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1 (Intercept)     308.       35.8       8.59  1.77e-16
##  2 Prob_solve_pre    3.37      0.764     4.41  1.34e- 5
##  3 extraversion     -0.244     0.385    -0.634 5.27e- 1
##  4 agreeableness    -0.107     0.487    -0.219 8.26e- 1
##  5 conscient.        0.921     0.482     1.91  5.70e- 2
##  6 stability         0.205     0.380     0.538 5.91e- 1
##  7 openness          0.360     0.562     0.642 5.21e- 1
##  8 Metacog.         -0.111     0.501    -0.221 8.25e- 1
##  9 SelfEfficacy     -0.237     0.592    -0.401 6.89e- 1
## 10 IntGoalOrient     0.198     1.07      0.186 8.53e- 1
## 11 ExtGoalOrient     0.189     0.888     0.213 8.31e- 1
```


---

### C. Mapping with ggplot2

A brief introduction for those interested, focused on the sf R package:

https://joshuamrosenberg.com/post/2020/06/08/basic-sf-functionality-for-analyzing-and-plotting-geospatial-data/

---

### Data Science Certificate

https://docs.google.com/document/d/1shNL9fY-vhBKK-zJw_V_iVhAKDtZ1Wqen4maJFnswQ4/edit

---

### Curating a data science resource

https://making-data-science-count.github.io/s21-intro-to-data-sci-methods-in-ed/assignment-curating-a-data-science-resource.html

---

# Logistics

**This week**

* Homework 13: Available tomorrow by noon; **Due by Thursday, 4/22**

* Readings: https://r4ds.had.co.nz/iteration.html#the-map-functions
            https://www.statisticssolutions.com/multiple-imputation-for-missing-data/

---

## Schedule

- The product for your final project and a recording that will serve as your presentation of it are both due by the end of the day on May 5
- *There is no portfolio!*
- Exam 3 is available now, due before class on April 22
- The revised data ethics statement is due April 29
- The curating a resource assignment is due by the same date/time as the final project - May 5

---

### Wrapping up

In your base group's Slack channel:

- What is one thing you learned today?
- What is something you want to learn more about? 
- Share your feelings in GIF form!
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
